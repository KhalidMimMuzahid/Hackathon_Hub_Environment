cd /home/hub/manual && echo "ðŸ§¹ COMPLETE CLEANUP AND REBUILD" && docker-compose -f docker-compose.prod.yml down -v --remove-orphans && docker-compose -f docker-compose.yml down -v --remove-orphans 2>/dev/null || true && docker-compose -f docker-compose.dev.yml down -v --remove-orphans 2>/dev/null || true && docker rmi manual-frontend manual-api 2>/dev/null || true && docker volume rm $(docker volume ls -q | grep manual) 2>/dev/null || true && docker network rm manual_hub_network 2>/dev/null || true && docker system prune -f && sed -i 's|NEXT_PUBLIC_API_BASE_URL=.*|NEXT_PUBLIC_API_BASE_URL=http://103.143.148.190:8000/api/v1|g' .env && sed -i 's|NEXT_PUBLIC_API_URL=.*|NEXT_PUBLIC_API_URL=http://103.143.148.190:8000|g' .env && echo "Updated environment:" && grep "NEXT_PUBLIC_API" .env && echo "Building from scratch..." && docker-compose -f docker-compose.prod.yml build --no-cache && echo "Starting services..." && docker-compose -f docker-compose.prod.yml up -d && echo "Waiting 45 seconds..." && sleep 45 && echo "Container status:" && docker ps && echo "Health checks:" && docker inspect hub_prod_frontend --format='{{.State.Health.Status}}' 2>/dev/null && docker inspect hub_prod_api --format='{{.State.Health.Status}}' 2>/dev/null && echo "Testing API:" && curl -f http://localhost:8000/health && echo "Testing remote API:" && curl -f http://103.143.148.190:8000/api/v1/users/login -X POST -H "Content-Type: application/json" -d '{"username":"test","password":"test"}' || echo "422 expected" && echo "Frontend logs:" && docker logs hub_prod_frontend --tail 10 && echo "ðŸŽ‰ REBUILD COMPLETE! Test at http://103.143.148.190/signIn"
